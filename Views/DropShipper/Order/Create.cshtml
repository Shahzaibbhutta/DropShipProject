@model CreateOrderViewModel

<h2>Create New Order</h2>

<form asp-action="Create" method="post">
    <div class="form-group">
        <label asp-for="SupplierId" class="control-label"></label>
        <select asp-for="SupplierId" class="form-control" asp-items="ViewBag.Suppliers"></select>
        <span asp-validation-for="SupplierId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Notes" class="control-label"></label>
        <textarea asp-for="Notes" class="form-control"></textarea>
        <span asp-validation-for="Notes" class="text-danger"></span>
    </div>

    <h4>Order Items</h4>
    <div id="orderItems">
        @for (int i = 0; i < Model.Items.Count; i++)
        {
            <div class="order-item row mb-3">
                <div class="col-md-5">
                    <input asp-for="Items[i].ProductName" class="form-control" placeholder="Product Name" />
                    <span asp-validation-for="Items[i].ProductName" class="text-danger"></span>
                </div>
                <div class="col-md-2">
                    <input asp-for="Items[i].Quantity" class="form-control" placeholder="Qty" />
                    <span asp-validation-for="Items[i].Quantity" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <input asp-for="Items[i].UnitPrice" class="form-control" placeholder="Unit Price" />
                    <span asp-validation-for="Items[i].UnitPrice" class="text-danger"></span>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger remove-item">Remove</button>
                </div>
            </div>
        }
    </div>

    <div class="form-group">
        <button type="button" id="addItem" class="btn btn-secondary">Add Item</button>
    </div>

    <div class="form-group">
        <input type="submit" value="Place Order" class="btn btn-primary" />
    </div>
</form>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Add new item
            $("#addItem").click(function() {
                var index = $("#orderItems .order-item").length;
                var html = `
                    <div class="order-item row mb-3">
                        <div class="col-md-5">
                            <input name="Items[${index}].ProductName" class="form-control" placeholder="Product Name" />
                        </div>
                        <div class="col-md-2">
                            <input name="Items[${index}].Quantity" class="form-control" placeholder="Qty" value="1" />
                        </div>
                        <div class="col-md-3">
                            <input name="Items[${index}].UnitPrice" class="form-control" placeholder="Unit Price" />
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-danger remove-item">Remove</button>
                        </div>
                    </div>
                `;
                $("#orderItems").append(html);
            });

            // Remove item
            $(document).on("click", ".remove-item", function() {
                $(this).closest(".order-item").remove();
                // Re-index remaining items
                $("#orderItems .order-item").each(function(index) {
                    $(this).find("input").each(function() {
                        var name = $(this).attr("name");
                        if (name) {
                            name = name.replace(/\[\d+\]/, `[${index}]`);
                            $(this).attr("name", name);
                        }
                    });
                });
            });
        });
    </script>
}